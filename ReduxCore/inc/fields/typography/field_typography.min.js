!function(a){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var b=[],c=!1,d={width:"resolve",triggerChange:!0,allowClear:!0};a(document).ready(function(){}),redux.field_objects.typography.init=function(e){e||(e=a(document).find(".redux-container-typography")),e.each(function(){a(this).find(".redux-typography-container").each(function(){var b=a(this).find(".redux-typography-family");""!==b.data("value")&&a(b).val(b.data("value"));var c=a(this).find(".select2_params");if(c.size()>0){var e=c.val();e=JSON.parse(e),d=a.extend({},d,e)}redux.field_objects.typography.select(b),window.onbeforeunload=null}),a(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(a(this))}),a(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(a(this).parents(".redux-container-typography:first"))}),a(this).find(".redux-typography-color").wpColorPicker({change:function(b,c){redux_change(a(this)),a(this).val(c.color.toString()),redux.field_objects.typography.select(a(this))}}),a(this).find(".redux-typography-size").numeric({allowMinus:!1}),a(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var e=[{id:"none",text:"none"}];a(this).find(".redux-typography-family").select2({matcher:function(a,b){return 0===b.toUpperCase().indexOf(a.toUpperCase())},query:function(a){return window.Select2.query.local(e)(a)},initSelection:function(a,b){var c={id:a.val(),text:a.val()};b(c)}}).on("select2-opening",function(){var b=a(this).parents(".redux-container-typography:first").attr("data-id"),c=a("#"+b+" .redux-typography-font-family").data("user-fonts");c=c?1:0;var d=a("#"+b+" .redux-typography-google").val();d=d?1:0;var f=[];if(void 0!==redux.customfonts&&f.push(redux.customfonts),void 0!==redux.stdfonts&&0===c&&f.push(redux.stdfonts),1==c){var g=[];for(var h in redux.typography[b]){var i=redux.typography[b].std_font;for(var j in i)i.hasOwnProperty(j)&&g.push({id:j,text:j,"data-google":"false"})}var k={text:"Standard Fonts",children:g};f.push(k)}(1==d||d===!0&&void 0!==redux.googlefonts)&&f.push(redux.googlefonts),e=f;var l=a("#"+b+" #"+b+"-family").attr("placeholder");l||(l=null),a("#"+b+" .redux-typography-family").select2("val",l)}).on("select2-selecting",function(d){var e=d.object.text,f=a(this).parents(".redux-container-typography:first").attr("data-id");a("#"+f+" #"+f+"-family").data("value",e),a("#"+f+" #"+f+"-family").attr("placeholder",e),b=d,c=!0,redux_change(a(this))}),a(this).find(" .redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(d)})},redux.field_objects.typography.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},redux.field_objects.typography.makeBool=function(a){return"false"==a||"0"==a||a===!1||0===a?!1:"true"==a||"1"==a||a===!0||1==a?!0:void 0},redux.field_objects.typography.contrastColour=function(a){var b="#444444";if(""!==a){a=a.replace("#","");var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16),f=(299*c+587*d+114*e)/1e3;b=f>=128?"#444444":"#ffffff"}return b},redux.field_objects.typography.select=function(e){var f=a(e).parents(".redux-container-typography:first").attr("data-id"),g=e.find("#"+f+" #"+f+"-family").val();g||(g=null);var h,i=e.find("#"+f+" select.redux-typography-family-backup").val(),j=e.find("#"+f+" .redux-typography-size").val(),k=e.find("#"+f+" .redux-typography-height").val(),l=e.find("#"+f+" .redux-typography-word").val(),m=e.find("#"+f+" .redux-typography-letter").val(),n=e.find("#"+f+" select.redux-typography-align").val(),o=e.find("#"+f+" select.redux-typography-transform").val(),p=e.find("#"+f+" select.redux-typography-font-variant").val(),q=e.find("#"+f+" select.redux-typography-decoration").val(),r=e.find("#"+f+" select.redux-typography-style").val(),s=e.find("#"+f+" select.redux-typography-subsets").val(),t=e.find("#"+f+" .redux-typography-color").val(),u=e.find("#"+f).data("units"),v=g;c===!0?(h=redux.field_objects.typography.makeBool(b.object["data-google"]),e.find("#"+f+" .redux-typography-google-font").val(h)):h=redux.field_objects.typography.makeBool(e.find("#"+f+" .redux-typography-google-font").val()),e.find("#"+f).hasClass("typography-initialized")||(r=e.find("#"+f+" select.redux-typography-style").data("value"),s=e.find("#"+f+" select.redux-typography-subsets").data("value"),""!==r&&(r=String(r)),void 0!==typeof s&&(s=String(s))),void 0===redux.fonts.google&&(h=!1);var w="";if(w=h===!0&&g in redux.fonts.google?redux.fonts.google[g]:{400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},a(e).hasClass("redux-typography-family")){var x='<option value=""></option>';if(h===!0){var y="";a.each(w.variants,function(a,b){b.id===r||1===redux.field_objects.typography.size(w.variants)?(y=' selected="selected"',r=b.id):y="",x+='<option value="'+b.id+'"'+y+">"+b.name.replace(/\+/g," ")+"</option>"}),e.find("#"+f+" .redux-typography-style").select2("destroy"),e.find("#"+f+" .redux-typography-style").html(x),e.find("#"+f+" .redux-typography-style").select2(d),y="",x='<option value=""></option>',a.each(w.subsets,function(a,b){b.id===s||1===redux.field_objects.typography.size(w.subsets)?(y=' selected="selected"',s=b.id):y="",x+='<option value="'+b.id+'"'+y+">"+b.name.replace(/\+/g," ")+"</option>"}),"undefined"!=typeof i&&""!==i&&(v+=", "+i),e.find("#"+f+" .redux-typography-subsets").select2("destroy"),e.find("#"+f+" .redux-typography-subsets").html(x),e.find("#"+f+" .redux-typography-subsets").select2(d),e.find("#"+f+" .redux-typography-subsets").parent().fadeIn("fast"),e.find("#"+f+" .typography-family-backup").fadeIn("fast")}else w&&(a.each(w,function(a,b){a===r||"normal"===a?(y=' selected="selected"',e.find("#"+f+" .typography-style .select2-chosen").text(b)):y="",x+='<option value="'+a+'"'+y+">"+b.replace("+"," ")+"</option>"}),e.find("#"+f+" .redux-typography-style").select2("destroy"),e.find("#"+f+" .redux-typography-style").html(x),e.find("#"+f+" .redux-typography-style").select2(d),e.find("#"+f+" .redux-typography-subsets").parent().fadeOut("fast"),e.find("#"+f+" .typography-family-backup").fadeOut("fast"));e.find("#"+f+" .redux-typography-font-family").val(v)}else a(e).hasClass("redux-typography-family-backup")&&""!==i&&e.find("#"+f+" .redux-typography-font-family").val(v);0===e.find("#"+f+" select.redux-typography-style option[value='"+r+"']").length?(r="",e.find("#"+f+" select.redux-typography-style").select2("val","")):"400"===r&&e.find("#"+f+" select.redux-typography-style").select2("val",r),0===e.find("#"+f+" select.redux-typography-subsets option[value='"+s+"']").length&&(s="",e.find("#"+f+" select.redux-typography-subsets").select2("val",""));var z="style_link_"+f;if(a("."+z).remove(),null!==g&&"inherit"!==g&&e.find("#"+f).hasClass("typography-initialized")){var A=g.replace(/\s+/g,"+");if(h===!0){var B=A;r&&(B+=":"+r.replace(/\-/g," ")),s&&(B+="&subset="+s),"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[B]}}),e.find("#"+f+" .redux-typography-google").val(!0)}else e.find("#"+f+" .redux-typography-google").val(!1)}if(-1!==r.indexOf("italic")?(e.find("#"+f+" .typography-preview").css("font-style","italic"),e.find("#"+f+" .typography-font-style").val("italic"),r=r.replace("italic","")):(e.find("#"+f+" .typography-preview").css("font-style","normal"),e.find("#"+f+" .typography-font-style").val("")),e.find("#"+f+" .typography-font-weight").val(r),k||(k=j),e.find("#"+f+" .typography-font-size").val(""===j?"":j+u),e.find("#"+f+" .typography-line-height").val(""===k?"":k+u),e.find("#"+f+" .typography-word-spacing").val(l+u),e.find("#"+f+" .typography-letter-spacing").val(m+u),e.find("#"+f).hasClass("typography-initialized")){var C=e.find("#"+f+" .typography-preview").data("preview-size");"0"==C&&e.find("#"+f+" .typography-preview").css("font-size",j+u),e.find("#"+f+" .typography-preview").css("font-weight",r),e.find("#"+f+" .typography-preview").css("font-family",g+", sans-serif"),"none"===g&&""===g&&e.find("#"+f+" .typography-preview").css("font-family","inherit"),e.find("#"+f+" .typography-preview").css("line-height",k+u),e.find("#"+f+" .typography-preview").css("word-spacing",l+u),e.find("#"+f+" .typography-preview").css("letter-spacing",m+u),t&&(e.find("#"+f+" .typography-preview").css("color",t),e.find("#"+f+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(t))),e.find("#"+f+" .typography-style .select2-chosen").text(e.find("#"+f+" .redux-typography-style option:selected").text()),e.find("#"+f+" .typography-script .select2-chosen").text(e.find("#"+f+" .redux-typography-subsets option:selected").text()),n&&e.find("#"+f+" .typography-preview").css("text-align",n),o&&e.find("#"+f+" .typography-preview").css("text-transform",o),p&&e.find("#"+f+" .typography-preview").css("font-variant",p),q&&e.find("#"+f+" .typography-preview").css("text-decoration",q),e.find("#"+f+" .typography-preview").slideDown()}e.find("#"+f).hasClass("typography-initialized")||e.find("#"+f).addClass("typography-initialized"),c=!1}}(jQuery);